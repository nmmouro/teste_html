<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Visualização de Planilha</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #f5f5f5;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 40px;
    background: white;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 6px 10px;
    text-align: left;
  }

  th {
    background: #eee;
  }

  /* ===== Estilo para LINHA CANCELADA ===== */
  .cancelado {
    background: #ffb3b3 !important;
    animation: piscar 1s infinite;
  }

  @keyframes piscar {
    0% { background: #ffb3b3; }
    50% { background: #ffffff; }
    100% { background: #ffb3b3; }
  }
</style>
</head>
<body>

<h2 id="titulo"></h2>
<div id="conteudo"></div>

<script>
/* ======================================================
   FUNÇÃO PARA ESCAPAR HTML
====================================================== */
function escapeHtml(text) {
  if (typeof text !== "string") return text;
  return text
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}

/* ======================================================
   FORMATAÇÃO DE CELULAS: DATA / HORA
====================================================== */
function formatCell(value, somenteHora = false) {
  if (typeof value === "string" && value.startsWith("Date(")) {
    const partes = value.match(/Date\((\d+),(\d+),(\d+)(?:,(\d+),(\d+),(\d+))?\)/);

    if (partes) {
      const ano = Number(partes[1]);
      const mes = Number(partes[2]) + 1;
      const dia = Number(partes[3]);
      const hora = Number(partes[4] || 0);
      const min = Number(partes[5] || 0);

      if (somenteHora) {
        return String(hora).padStart(2, "0") + ":" + String(min).padStart(2, "0");
      }

      return (
        String(dia).padStart(2, "0") + "/" +
        String(mes).padStart(2, "0") + "/" +
        ano
      );
    }
  }

  return value;
}

/* ======================================================
   RENDERIZA A TABELA
====================================================== */
function renderSheet(sheetName, data) {
  const conteudo = document.getElementById("conteudo");
  let html = `<h3>${sheetName}</h3><table>`;

  const cols = data[0];
  html += "<tr>";
  cols.forEach(c => html += `<th>${escapeHtml(c)}</th>`);
  html += "</tr>";

  data.slice(1).forEach(r => {
    const linhaTexto = r.join(" ").toLowerCase();
    const classeCancelado = linhaTexto.includes("cancelado") ? "cancelado" : "";

    html += `<tr class="${classeCancelado}">`;

    r.forEach((cell, idx) => {
      const somenteHora =
        ((sheetName === "AGENDA DO DIA" || sheetName === "PAINEL") &&
         cols[idx].toLowerCase().includes("hora"));

      const valor = formatCell(cell, somenteHora);
      html += `<td>${escapeHtml(valor)}</td>`;
    });

    html += "</tr>";
  });

  html += "</table>";
  conteudo.innerHTML += html;
}

/* ======================================================
   CARREGAMENTO SIMULADO (substitua pelo fetch real)
====================================================== */
async function carregar() {
  document.getElementById("titulo").innerText = "Carregando dados da planilha...";

  /* Aqui você usa fetch() na sua API real.
     Vou deixar um exemplo de estrutura: */

  const SHEET_ID = "1Ch3AjQ0MDo4WuQWFDR3r8nZrHb4yQkSLOtT5_QgxT6E";

  const resposta = await fetch("dados.json");
  const planilhas = await resposta.json();

  document.getElementById("titulo").innerText = "Visualização da Planilha";

  Object.keys(planilhas).forEach(sheetName => {
    renderSheet(sheetName, planilhas[sheetName]);
  });
}

carregar();
</script>

</body>
</html>
